# Flutter Windows 批量圖片偵測（藍條座標抽取）

這是一個最小可用（MVP）的 Flutter 桌面應用，用 **傳統影像處理** 在 Windows 上批量處理圖片，輸出每張圖中「藍條的
x/y 座標」。

* X：0–1 的比例（中心與起訖）
* Y：以「灰線間距為 1」的連續值，由 **下往上** 計算（可為負，支援最底線下方的藍條）
* 另外提供 `y_norm_0_1` 把 0..9 壓到 0..1 方便後續使用

---

## 5) 參數微調建議

* **藍色 HSV 範圍**：在 `detector.dart` 的 `_blueMask` 內調整 `H/S/V` 條件（可用你資料集微調）。
* **形態學核大小**：`_morphClose(..., k=3)`，若藍條破碎可增大為 `5` 或 `7`。
* **峰值門檻**：`_detectGridLines` 裡 `thr = percentile(92%)`，若偵測不到 10 條，可把 92 調低一點；或加大平滑窗口
  `k`。
* **bbox 過濾**：`ar > 3` 與 `area/bw/bh` 閾值是用來剔除雜訊與細屑，可依情況微調。

---

## 6) 執行

1. `flutter pub get`
2. `flutter run -d windows`
3. UI 內選擇「輸入資料夾」與「輸出 JSON」→ 按「開始批量處理」

---

## 7) 後續可加的功能

* 結果視覺化：把偵測到的 bbox 與灰線畫回圖片另存（便於人工審查）
* 參數面板：提供 H/S/V、形態學核、面積/長寬比閾值的 UI 控制
* 多執行緒：用 `Isolate` 把每張圖分派到工作執行緒以提升處理速度
* 影片抽幀：挑每 N 幀輸出一幀，直接批量跑整支影片

---

如需，我可以再幫你：

* 加上「可視化輸出」與 QA 視窗
* 做一鍵處理整個資料夾含子資料夾
* 將結果同步輸出 `.csv`/`.jsonl` 或自動貼回資料庫
